- debug:
    msg: "Priv_Key {{ Priv_Key }}"

- fail: # Check this one.
    msg: "The private key {{ private_key }} already exist"
  when: Priv_Key

- name: Create san.cnf on server
  template:
    src: san.cnf.j2
    dest: "{{ san_cnf }}"
    mode: '0606'

- name: Create Private Key
  # openssl req -out sslcert.csr -newkey rsa:2048 -nodes -keyout private.key -config san.cnf
  shell:
    cmd: "openssl req -out {{ sslcert_csr }} -newkey rsa:2048 -nodes -keyout {{ private_key }} -config {{ san_cnf }}"
    creates: "{{ private_key }}"

- name: Create email instructions
  template:
    src: email.txt.j2
    dest: "{{ email_filename }}"
    mode: '0666'
